import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table";
import { format, parse, isValid } from "date-fns";

async function sorgulamalariBaslat() {
  const numbersArray = [
    '99999637472',
'99999386462',
'99999316858',
'99999277630',
'99999267426',
'99999160406',
'99999083736',
'99999075434',
'99999067064',
'99998967174',
'99998844314',
'99998687836',
'99998523622',
'99998514644',
'99997488700',
'99997461284',
'99997236868',
'99996818492',
'99996805904',
'99996783752',
'99996582928',
'99996481016',
'99996476548',
'99996440730',
'99996275400',
'99996223548',
'99996195074',
'99996186300',
'99996109552',
'99996089458',
'99996085702',
'99996067678',
'99996048936',
'99995953750',
'99995818592',
'99995549212',
'99995478314',
'99995477256',
'99995468896',
'99995402838',
'99995340154',
'99994311162',
'99993810604',
'99993801626',
'99993588268',
'99993502882',
'99993437542',
'99993432110',
'99993405244',
'99993388806',
'99993387366',
'99993355372',
'99993331826',
'99993181728',
'99993145706',
'99992986416',
'99992719274',
'99992598640',
'99992533122',
'99992491316',
'99992382102',
'99991268834',
'99990895222',
'99990829432',
'99990814278',
'99990762258',
'99990673912',
'99990652818',
'99990639284',
'99990629766',
'99990558622',
'99990470658',
'99990449104',
'99990408828',
'99990381480',
'99990340340',
'99990333274',
'99990240800',
'99990142722',
'99990136400',
'99990128344',
'99990112022',
'99990106878',
'99990091242',
'99990089676',
'99989961426',
'99989743008',
'99989058232',
'99988843716',
'99988795824',
'99988589454',
'99988505362',
'99988288944',
'99987699130',
'99987618704',
'99987560126',
'99987305932',
'99987292836',
'99987244170',
'99987171988',
'99987147396',
'99987080808',
'99987076252',
'99986931408',
'99986888252',
'99986826018',
'99986380428',
'99986378470',
'99986152582',
'99985322344',
'99985233008',
'99984645284',
'99984627914',
'99984562192',
'99984448342',
'99984381540',
'99984328552',
'99984220610',
'99984172100',
'99984137796',
'99984121542',
'99984108154',
'99984086148',
'99984080108',
'99983821290',
'99983603636',
'99983459400',
'99983414300',
'99982442366',
'99982341690',
'99982235838',
'99981804974',
'99981565394',
'99981277372',
'99981230360',
'99981196574',
'99980691810',
'99980540408',
'99980436244',
'99980256378',
'99980060494',
'99979452576',
'99979438020',
'99979366996',
'99979283286',
'99978904892',
'99978863144',
'99978613350',
'99978579946',
'99978503392',
'99978489788',
'99978451754',
'99978448716',
'99978440178',
'99978391746',
'99978343462',
'99978289258',
'99978198796',
'99978195894',
'99978116066',
'99978106784',
'99978091844',
'99978087298',
'99977970546',
'99977891650',
'99977881200',
'99977607510',
'99977548042',
'99977519400',
'99977410950',
'99977301296',
'99977155608',
'99977110508',
'99976508160',
'99976473598',
'99976346700',
'99976335292',
'99976271774',
'99976238722',
'99976236810',
'99976054414',
'99975943702',
'99975769180',
'99975579178',
'99975467444',
'99975423716',
'99975421736',
'99975336528',
'99975278040',
'99975270648',
'99975245134',
'99975211610',
'99975085068',
'99975070354',
'99975068924',
'99974988070',
'99974832304',
'99974709880',
'99974516358',
'99974468848',
'99974463270',
'99973505186',
'99973360938',
'99973315488',
'99973293922',
'99973293540',
'99973270916',
'99972978820',
'99972907776',
'99972598660',
'99972470478',
'99972411068',
'99972368430',
'99972253040',
'99972248268',
'99972230898',
'99972134240',
'99972118578',
'99972114440',
'99972097248',
'99972096494',
'99971950582',
'99971946240',
'99971843730',
'99971575686',
'99971454738',
'99971048456',
'99970825706',
'99970798390',
'99970287696',
'99969984216',
'99969773032',
'99969701202',
'99969667416',
'99969607184',
'99969562162',
'99969539706',
'99969525228',
'99969491882',
'99969428208',
'99969364858',
'99969335452',
'99969269436',
'99969226620',
'99969224572',
'99969223414',
'99969202174',
'99969193410',
'99969173238',
'99969125954',
'99969094960',
'99968932072',
'99968718850',
'99968568820',
'99968559392',
'99968504156',
'99968438130',
'99968429534',
'99967818018',
'99967506922',
'99966937222',
'99966857964',
'99966774568',
'99966754454',
'99966701434',
'99966643024',
'99966510814',
'99966432840',
'99966394926',
'99966341388',
'99966305366',
'99966263864',
'99966257160',
'99966179264',
'99966108738',
'99966072008',
'99966061972',
'99965788146',
'99965749390',
'99965739322',
'99965467140',
'99965071668',
'99965064288',
'99964475856',
'99964374326',
'99964370984',
'99964290930',
'99964237256',
'99964012112',
'99963893354',
'99963798246',
'99963766948',
'99963636012',
'99963473730',
'99963467586',
'99963428594',
'99963328740',
'99963308940',
'99963273132',
'99963160272',
'99963086886',
'99963027094',
'99962943708',
'99962643288',
'99962578948',
'99962469284',
'99962448180',
'99962151608',
'99961479352',
'99961475606',
'99961442936',
'99961366874',
'99960812846',
'99960753514',
'99960613542',
'99960586518',
'99960550250',
'99960549988',
'99960506936',
'99960400524',
'99960381106',
'99960373118',
'99960357828',
'99960312728',
'99960290026',
'99960285862',
'99960248546',
'99960225394',
'99960223314',
'99960150740',
'99960093320',
'99960054260',
'99959516878',
'99959502468',
'99959493322',
'99959406810',
'99959071582',
'99958325112',
'99958316752',
'99958291462',
'99958010360',
'99957678448',
'99957484162',
'99957442100',
'99957426988',
'99957377310',
'99957289064',
'99957234132',
'99957185564',
'99957155246',
'99957119088',
'99957104442',
'99957049170',
'99956975852',
'99956567972',
'99955425570',
'99955342860',
'99955153220',
'99954852988',
'99954810780',
'99954511182',
'99954491842',
'99954471042',
'99954442264',
'99954425120',
'99954341802',
'99954110828',
'99954103998',
'99954071228',
'99954060642',
'99953947050',
'99953588130',
'99953577936',
'99953560488',
'99953530306',
'99953515860',
'99953313428',
'99953157930',
'99952502090',
'99952322988',
'99951962178',
'99951793338',
'99951694260',
'99951662658',
'99951654424',
'99951503180',
'99951471892',
'99951467000',
'99951432046',
'99951406610',
'99951391602',
'99951308846',
'99951308464',
'99951290240',
'99951216608',
'99951196122',
'99951194388',
'99951189742',
'99951185232',
'99951165128',
'99951156768',
'99951102376',
'99951082036',
'99951055610',
'99950689274',
'99950606004',
'99950532372',
'99950457064',
'99950437714',
'99950395212',
'99949825072',
'99949439118',
'99949256722',
'99949255282',
'99949005498',
'99948812684',
'99948692590',
'99948654048',
'99948447688',
'99948432660',
'99948418596',
'99948405008',
'99948346530',
'99948308538',
'99948253548',
'99948174652',
'99948169634',
'99948154166',
'99948124084',
'99948097814',
'99948087778',
'99947829232',
'99947046356',
'99946296172',
'99946254288',
'99945822570',
'99945799988',
'99945756172',
'99945623580',
'99945541792',
'99945468082',
'99945456966',
'99945423746',
'99945349350',
'99945294056',
'99945112640',
'99945111278',
'99945106632',
'99945095820',
'99945092928',
'99944976366',
'99944964172',
'99944935530',
'99944923100',
'99944922288',
'99944693812',
'99944661132',
'99944512014',
'99944430158',
'99944410594',
'99944183030',
'99944154566',
'99944072464',
'99944055252',
'99943498814',
'99943442138',
'99943342834',
'99943267830',
'99943229074',
'99942979772',
'99942756472',
'99942717930',
'99942651500',
'99942509894',
'99942501560',
'99942485808',
'99942481770',
'99942366480',
'99942339446',
'99942303874',
'99942278370',
'99942224674',
'99942204874',
'99942169852',
'99942139220',
'99942135888',
'99942134270',
'99942128330',
'99942082328',
'99942035416',
'99941656414',
'99941455208',
'99941063922',
'99940491634',
'99940441134',
'99940297144',
'99939810514',
'99939715338',
'99939481158',
'99939473474',
'99939361290',
'99939322376',
'99939307526',
'99939301104',
'99939254752',
'99939188118',
'99939111406',
'99939109458',
'99938973524',
'99938970622',
'99938669212',
'99938578446',
'99938576084',
'99938568300',
'99938053264',
'99937469882',
'99937354638',
'99937352030',
'99936940986',
'99936830478',
'99936578578',
'99936467216',
'99936452816',
'99936430036',
'99936408806',
'99936384292',
'99936381222',
'99936327244',
'99936252072',
'99936245524',
'99936226196',
'99936225892',
'99936197250',
'99936151856',
'99936083478',
'99936068550',
'99936011402',
'99936005012',
'99936004022',
'99935891968',
'99935611160',
'99935349438',
'99935145634',
'99934503428',
'99934492234',
'99934320896',
'99934315014',
'99934292636',
'99934249098',
'99934057792',
'99934016348',
'99933730238',
'99933728730',
'99933659744',
'99933659508',
'99933642128',
'99933611292',
'99933549618',
'99933530562',
'99933430190',
'99933428074',
'99933425790',
'99933332562',
'99933323898',
'99933303920',
'99933301322',
'99933295638',
'99933156342',
'99933142864',
'99933088728',
'99933084904',
'99933068928',
'99932648572',
'99932470272',
'99932080358',
'99932070526',
'99931352326',
'99930609780',
'99930593300',
'99930500476',
'99930485636',
'99930476344',
'99930363620',
'99930338666',
'99930336204',
'99930335900',
'99930300564',
'99930268208',
'99930219866',
'99930218630',
'99930209584',
'99930082774',
'99930074304',
'99930065562',
'99929602860',
'99929048392',
'99929047166',
'99928466036',
'99927811264',
'99927655912',
'99927475282',
'99927431868',
'99927419910',
'99927379498',
'99927369352',
'99927366696',
'99927334152',
'99927312136',
'99927305442',
'99927303912',
'99927233622',
'99927118332',
'99927088956',
'99927054432',
'99926645730',
'99926318894',
'99926150944',
'99925436018',
'99925328658',
'99925258122',
'99924785216',
'99924601066',
'99924576494',
'99924451340',
'99924379002',
'99924374502',
'99924323258',
'99924301096',
'99924283804',
'99924274680',
'99924241156',
'99924190676',
'99924164318',
'99924162024',
'99924075690',
'99924022502',
'99923535522',
'99923047766',
'99922798140',
'99922462744',
'99922222164',
'99922213568',
'99921947426',
'99921667256',
'99921643632',
'99921592466',
'99921573588',
'99921453552',
'99921453316',
'99921412030',
'99921283968',
'99921233604',
'99921227450',
'99921196770',
'99921160030',
'99920711042',
'99920696684',
'99920408034',
'99919516054',
'99919465406',
'99919343940',
'99918791834',
'99918520182',
'99918502744',
'99918349608',
'99918299354',
'99918273132',
'99918194932',
'99918075828',
'99918069742',
'99917946150',
'99917885398',
'99917861460',
'99917766970',
'99917464548',
'99917414352',
'99917053902',
'99916802464',
'99916366942',
'99916275008',
'99915788028',
'99915770726',
'99915643938',
'99915468944',
'99915461464',
'99915288696',
'99915178188',
'99915143360',
'99914975542',
'99914974866',
'99914718446',
'99914455242',
'99914440224',
'99913371574',
'99913315134',
'99913298796',
'99913014488',
'99912541190',
'99912533584',
'99912482622',
'99912427586',
'99912370516',
'99912342278',
'99912300384',
'99912294904',
'99912288750',
'99912262910',
'99912213028',
'99912163156',
'99912134750',
'99912104364',
'99912072762',
'99912048866',
'99911802100',
'99911687448',
'99911584174',
'99911439702',
'99911424234',
'99911385870',
'99910406996',
'99910302328',
'99910124678',
'99909750086',
'99909731894',
'99909486374',
'99909484080',
'99909437864',
'99909402282',
'99909364504',
'99909251330',
'99909210436',
'99909196372',
'99909138570',
'99909082040',
'99909048626',
'99908977378',
'99908972878',
'99908949726',
'99908823682',
'99907507736',
'99907253206',
'99907155500',
'99907014784',
'99906530742',
'99906503494',
'99906369236',
'99906275018',
'99906273038',
'99906234350',
'99906229882',
'99906153552',
'99906119756',
'99906044652',
'99905889940',
'99905875844',
'99905767002',
'99905676304',
'99905643702',
'99905107808',
'99904458840',
'99904383128',
'99903750204',
'99903673602',
'99903462596',
'99903454294',
'99903395962',
'99903346216',
'99903323682',
'99903274250',
'99903251930',
'99903247520',
'99903236708',
'99903236562',
'99903220790',
'99903119810',
'99903093462',
'99903091932',
'99903088826',
'99903083630',
'99902958090',
'99902943218',
'99902911774',
'99902867156',
'99902817656',
'99902568480',
'99901633820',
'99900824090',
'99900696604',
'99900619092',
'99900582136',
'99900579570',
'99900510542',
'99900495320',
'99900473540',
'99900461806',
'99900352074',
'99900341016',
'99900305544',
'99900238910',
'99900147694',
'99900133802',
'99900119974',
'99900102662',
'99900083794',
'99900071982',
'99900042890',
'99900042654',
'99900024148',
'99899911634',
'99898846630',
'99898012332',
'99897670724',
'99897372802',
'99897306708',
'99897290632',
'99897250728',
'99897239860',
'99897178558',
'99897119384',
'99897106032',
'99896730764',
'99896472688',
'99896146596',
'99895490058',
'99895459222',
'99895257644',
'99894883042',
'99894784806',
'99894690510',
'99894667840',
'99894401970',
'99894390304',
'99894383160',
'99894312252',
'99894250882',
'99894229338',
'99894168026',
'99894128426',
'99894104284',
'99894101696',
'99893879664',
'99893878506',
'99893874614',
'99893771968',
'99893694670',
'99893585084',
'99893552000',
'99893051992',
'99892505052',
'99892483428',
'99892365922',
'99892342466',
'99891814346',
'99891789460',
'99891749006',
'99891727226',
'99891689920',
'99891430812',
'99891379128',
'99891311876',
'99891232676',
'99891184784',
'99891154534',
'99891128580',
'99891122236',
'99891105338',
'99891091938',
'99891089812',
'99891053004',
'99890981452',
'99890765328',
'99890510102',
'99890323238',
'99889328534',
'99889327230',
'99889291432',
'99889090462',
'99888960872',
'99888702168',
'99888603540',
'99888504786',
'99888482916',
'99888392758',
'99888339524',
'99888303266',
'99888236946',
'99888194376',
'99888171742',
'99888099886',
'99887878734',
'99887852062',
'99887757336',
'99887715060',
'99887691524',
'99887685448',
'99887292554',
'99886470922',
'99885999400',
'99885743430',
'99885715956',
'99885630402',
'99885514368',
'99885487402',
'99885454596',
'99885438824',
'99885408988',
'99885187814',
'99885173404',
'99885086070',
'99885059890',
'99884985404',
'99884778808',
'99884534268',
'99884364124',
'99883822762',
'99883380378',
'99883323948',
'99883244434',
'99883190298',
'99882963824',
'99882902670',
'99882804424',
'99882801522',
'99882781664',
'99882764902',
'99882567060',
'99882527460',
'99882489096',
'99882268462',
'99882210942',
'99882140652',
'99882115520',
'99882089968',
'99881895232',
'99881859388',
'99881642164',
'99881467170',
'99880513632',
'99880244420',
'99879838494',
'99879659754',
'99879655244',
'99879479710',
'99879456186',
'99879451990',
'99879382690',
'99879344070',
'99879341314',
'99879245834',
'99879225102',
'99879211006',
'99879181316',
'99879138778',
'99879121466',
'99879084464',
'99879079828',
'99879035404',
'99878969724',
'99878784662',
'99878541012',
'99878515440',
'99878436004',
'99878052266',
'99877557502',
'99877366364',
'99877224480',
'99876816846',
'99876682274',
'99876442380',
'99876386196',
'99876264012',
'99876232714',
'99876162660',
'99876127010',
'99876113778',
'99876083774',
'99876080490',
'99876079296',
'99875881746',
'99875587648',
'99875479356',
'99874503342',
'99874315792',
'99874207714',
'99873961372',
'99873615930',
'99873577016',
'99873490100',
'99873489388',
'99873486172',
'99873472458',
'99873436986',
'99873404824',
'99873312068',
'99873271860',
'99873242600',
'99873185730',
'99873145444',
'99873133946',
'99873097002',

  ];

  const promises = numbersArray.map(async (number) => {
    try {
      const response = await fetch(
        "http://api-gateway-service.ybportal.csgb.gov.tr/goc-service/kisi-bilgi-statu/sorgulaV2",
        {
          method: "POST",

          headers: {
            "Content-Type": "application/json",
            ApiKey: "r89bgtws-t4l6-25ot-sz844-9833ne684527",
          },
          body: JSON.stringify({
            fotografGetir: false,
            gecmisListeGetir: true,
            kimlikNo: number,
          }),
        }
      );

      const data = await response.json();
      return [number, data];
    } catch (error) {
      return [number, { error: true, message: error.message }];
    }
  });

  const results = await Promise.all(promises);
  return results;
}

// Sözlükler

const kisaDonemNedenleri = {
  1: "Bilimsel araştırma amacıyla gelecekler",
  2: "Türkiye'de taşınmaz malı bulunanlar",
  3: "Ticari bağlantı veya iş kuracaklar",
  6: "Turizm amaçlı kalacaklar",
  15: "Kamu kurumları aracılığıyla eğitim, araştırma, staj ve kurslara katılacaklar",
  5: "Öğrenci değişim programları çerçevesinde eğitim görecekler",
  17: "Staj amaçlı değişim programları çerçevesinde eğitim görecekler",
  12: "Yükseköğrenimini tamamlayıp 6 ay içinde müracaat edenler",
  4: "Hizmet içi eğitim programlarına katılacaklar",
  9: "İdari makamların kararı",
  8: "İdari makamların talebi",
  18: "6458 sayılı Yabancılar ve Uluslararası Koruma Kanununun 31. Maddesinin j bendi kapsamında",
  19: "KKTC Vatandaşı",
  16: "Aile ikamet izninden kısa dönem ikamet iznine geçenler",
  13: "Anlaşmalar çerçevesinde eğitim",
  7: "Tedavi görecekler",
  14: "Türkçe öğrenme kurslarına katılacaklar",
};

const uzunDonemTurkSoylu = {
  1: "KKTC VATANDAŞLARI",
  2: "AHISKA TÜRKÜ",
  3: "ÇEÇEN ASILLI YABANCI",
  4: "KARADENİZ",
  5: "UYGUR TÜRKÜ",
  6: "BULGARİSTAN TÜRKÜ",
  7: "BATI TRAKYA TÜRKÜ",
  8: "IRAK TÜRKMENİ",
  9: "AFGANİSTAN TÜRKÜ",
  10: "KIRIM TATARI",
  11: "ESKİ YUGOSLAVYA UYRUKLU",
  12: "YUNANİSTAN ISKATI",
};

const insaniIkametNedenleri = {
  5: "53. maddeye göre sınır dışı etme kararına karşı yargı yoluna başvurulduğunda",
  4: "55. madde uyarınca yabancı hakkında sınır dışı etme kararı alınmadığında",
  6: "72. maddeye göre kabul edilemez başvuru kararına karşı yargı yoluna başvurulduğunda",
  7: "77. maddeye göre başvurunun geri çekilmesi veya geri çekilmiş sayılmasına karşı yargı yoluna başvuru",
  9: "Acil nedenlerden dolayı Türkiye’de kalmasına izin verilmesi gereken",
  20: "Başvuru sahibinin ilk iltica ülkesi veya güvenli üçüncü ülkeye geri gönderilmesi işlemlerinin devamı süresince",
  8: "Başvuru sahibinin geri gönderilmesi işlemlerinin devamı süresince",
  14: "Ciddi sağlık sorunları nedeniyle seyahat etmesi riskli görülenler",
  1: "Çocuğun yüksek yararı",
  16: "Hamilelik durumu nedeniyle seyahat etmesi riskli görülenler",
  17: "Hayati tehlike arz eden hastalıkları için tedavisi devam etmekteyken sınır dışı edileceği ülkede tedavi imkanı bulunmayanlar",
  10: "Kamu düzeni ve kamu güvenliği açısından Türkiye’de kalmasına izin verilmesi gereken",
  18: "Mağdur destek sürecinden yararlanmakta olan insan ticareti mağdurları",
  11: "Olağanüstü durumlarda",
  13: "Sınır dışı edileceği ülkede ölüm cezasına, işkenceye, insanlık dışı veya onur kırıcı ceza veya muameleye maruz kalacağı konusunda ciddi emare bulunanlar",
  2: "Sınır dışı/giriş yasağı kararına rağmen çıkışları yaptırılamayan",
  12: "Sınır dışı/giriş yasağı kararına rağmen Türkiye’den ayrılmaları makul veya mümkün görülmeyen",
  19: "Tedavileri tamamlanıncaya kadar psikolojik, fiziksel veya cinsel şiddet mağdurları",
  3: "Türkiye’den ayrılmaları makul veya mümkün görülmeyen",
  21: "Ülke menfaatlerinin korunması ile Kamu düzeni ve kamu güvenliği açısından Türkiye’de kalmasına izin verilmesi gereken",
  15: "Yaş durumu nedeniyle seyahat etmesi riskli görülenler",
};

const aileDestekleyiciTur = {
  1: "Destekleyicinin Eşi",
  2: "Destekleyicinin Ergin Olmayan Çocuğu",
  3: "Destekleyicinin Bakmakla Yükümlü Olduğu Çocuğu",
  4: "Destekleyicinin Eşinin Ergin Olmayan Çocuğu",
  5: "Destekleyicinin Eşinin Bakmakla Yükümlü Olduğu Çocuğu",
};

const ogrenciKalisNeden = {
  6: "Açıköğretim – Uzaktan Eğitim Programları",
  9: "Askeri Liseler",
  8: "Askeri Okullarda Öğrenim Görenler",
  20: "Diğer Uluslararası Değişim Programları Kapsamında Öğrenci Olarak Gelenler",
  4: "Diş Hekimliğinde Uzmanlık Eğitimi Alanlar / DUS",
  19: "Doktora",
  2: "Erasmus Programı Kapsamında Öğrenci Olarak Gelenler",
  17: "Harp Okulları",
  10: "İlkokul",
  21: "İlkokul",
  15: "Lisans - Diş Hekimliği / Eczacılık / Veterinerlik Fakülteleri",
  16: "Lisans - Tıp Fakültesi",
  14: "Lisans",
  12: "Lise",
  23: "Lise",
  7: "MEB’e Bağlı Olmayan Okullarda Öğrenim Görenler",
  11: "Ortaokul",
  22: "Ortaokul",
  13: "Ön Lisans",
  1: "Temel Eğitim- Ortaöğretim- Yükseköğretim",
  3: "Tıpta Uzmanlık Eğitimi Alanlar / TUS",
  5: "Üniversitesi Tarafından Türkçe Kursuna Yönlendirilenler",
  18: "Yüksek Lisans",
};

// En yakın bitiş tarihli kaydı döner
function getEnYakinKayit(list, tarihAlan = "bitisTarihi") {
  if (!Array.isArray(list) || list.length === 0) return null;

  return list.reduce((closest, current) => {
    const currentDate = current[tarihAlan]
      ? parse(current[tarihAlan], "dd/MM/yyyy", new Date())
      : null;
    const closestDate = closest[tarihAlan]
      ? parse(closest[tarihAlan], "dd/MM/yyyy", new Date())
      : null;

    const isCurrentValid = currentDate && isValid(currentDate);
    const isClosestValid = closestDate && isValid(closestDate);

    if (!isCurrentValid) return closest;
    if (!isClosestValid) return current;

    return currentDate < closestDate ? current : closest;
  });
}

//Gerekçeyi döner
function getGerekce(ikametOzetList, ikametIzniBilgileriList) {

  // if (!Array.isArray(ikametOzetList) || ikametOzetList.length === 0) return "Veri Yok";
  // if (!Array.isArray(ikametIzniBilgileriList) || ikametIzniBilgileriList.length === 0) return "Veri Yok";

  const enYakinIkamet = getEnYakinKayit(ikametOzetList, "bitisTarihi");
  if (!enYakinIkamet || !enYakinIkamet.verilisNedeni) return "Veri Yok";

  const tip = enYakinIkamet.verilisNedeni;

                                          

  // En yakın bitiş tarihli izin bilgisini bul
  let enYakinIzin = getEnYakinKayit(ikametIzniBilgileriList, "bitisTarihi");
 
  console.log("en yakın ikamet",enYakinIkamet) // var
                                    
  if (
    !enYakinIzin &&
    Array.isArray(ikametOzetList) &&
    ikametOzetList.length > 0
  ) {
    enYakinIzin = getEnYakinKayit(ikametIzniBilgileriList, "bitisTarihi");
  }
  console.log("en yakın izin",enYakinIzin) // yok
  if (!enYakinIzin) return "Veri Yok";

  if (tip.toLowerCase().includes("kısa")) {
   
   
   return (
      kisaDonemNedenleri[
        enYakinIzin.kisaDonemKalisNeden as keyof typeof kisaDonemNedenleri
      ] || "Bilinmeyen Gerekçe"
    );

    // kısa dönem işlemleri
  } else if (tip.toLowerCase().includes("uzun")) {
    if (!enYakinIzin.turkSoylu) return "Veri Yok";
  } else if (tip.toLowerCase().includes("insani")) {
    if (!enYakinIzin.insaniIkametIzniKalisNeden) return "Veri Yok";
    return (
      insaniIkametNedenleri[
        enYakinIzin.insaniIkametIzniKalisNeden as keyof typeof insaniIkametNedenleri
      ] || "Bilinmeyen Gerekçe"
    );
    // insani ikamet işlemleri
  } else if (tip.toLowerCase().includes("aile")) {
    if (!enYakinIzin.aileDestekleyiciTur) return "Veri Yok";
    return (
      aileDestekleyiciTur[
        enYakinIzin.aileDestekleyiciTur as keyof typeof aileDestekleyiciTur
      ] || "Bilinmeyen Gerekçe"
    );
    // aile ikamet işlemleri
  } else if (tip.toLowerCase().includes("öğrenci")) {
    if (!enYakinIzin.ogrenciKalisNeden) return "Veri Yok";
    return (
      ogrenciKalisNeden[
        enYakinIzin.ogrenciKalisNeden as keyof typeof ogrenciKalisNeden
      ] || "Bilinmeyen Gerekçe"
    );
    // öğrenci işlemleri
  } 

  // diğer işlemler
}

const Home = async () => {
  const baslangicZamani = new Date();

  const sonuclar = await sorgulamalariBaslat();

  const bitisZamani = new Date();

  // En yakın bitiş tarihli ikamet özetini döner
  const getEnYakinIkamet = (ikametOzetList) => {
    if (!Array.isArray(ikametOzetList) || ikametOzetList.length === 0)
      return null;

    return ikametOzetList.reduce((closest, current) => {
      const currentDate = current?.bitisTarihi
        ? new Date(current.bitisTarihi)
        : null;
      const closestDate = closest?.bitisTarihi
        ? new Date(closest.bitisTarihi)
        : null;

      if (!currentDate) return closest;
      if (!closestDate) return current;

      return currentDate > closestDate ? current : closest;
    });
  };

  return (
    <div className="flex flex-col gap-4 p-4">
      <div>
        <strong>Sorgu Başlangıç Zamanı:</strong>{" "}
        {format(baslangicZamani, "dd/MM/yyyy HH:mm:ss")}
      </div>
      <div>
        <strong>Sorgu Bitiş Zamanı:</strong>{" "}
        {format(bitisZamani, "dd/MM/yyyy HH:mm:ss")}
      </div>

      <Table>
        <TableHeader>
          <TableRow>
            <TableHead>YKN</TableHead>
            <TableHead>YABANCI ADI</TableHead>
            <TableHead>YABANCI SOYADI</TableHead>
            <TableHead>DOĞUM TARİHİ</TableHead>
            <TableHead>ADRES</TableHead>
            <TableHead>AKTİF İZİN TÜRÜ</TableHead>
            <TableHead>İKAMET BİTİŞ TARİHİ (EN YAKIN)</TableHead>
            <TableHead>GEREKÇESİ</TableHead> {/* Yeni sütun */}
          </TableRow>
        </TableHeader>
        <TableBody>
          {sonuclar.map(([numara, veri], index) => {
            const kisi = veri?.data?.kisi || {};
            const aktifIzinTur = kisi?.aktifIzinTur;
            const ikametOzetList = kisi?.ikametOzetList || [];
            const ikametIzniBilgileriList = veri?.data?.ikametIzniBilgileriList || [];
            console.log("tablodaki ikametiznibilgileri list",ikametIzniBilgileriList)

            const enYakinIkamet = getEnYakinIkamet(ikametOzetList);
            const gerekce = getGerekce(ikametOzetList, ikametIzniBilgileriList);

            return (
              <TableRow key={index}>
                <TableCell>{numara ?? "Veri Yok"}</TableCell>
                <TableCell>
                  {veri?.success ? kisi.ad ?? "Veri Yok" : "Veri Yok"}
                </TableCell>
                <TableCell>
                  {veri?.success ? kisi.soyad ?? "Veri Yok" : "Veri Yok"}
                </TableCell>
                <TableCell>
                  {veri?.success ? kisi.dogumTarih ?? "Veri Yok" : "Veri Yok"}
                </TableCell>
                <TableCell>
                  {veri?.success
                    ? kisi.iletisimAdres?.ikametAcikAdres ?? "Veri Yok"
                    : "Veri Yok"}
                </TableCell>
                <TableCell>
                  {veri?.success && aktifIzinTur
                    ? 
                      " " +
                      (enYakinIkamet?.verilisNedeni ?? "")
                    : "Veri Yok"}
                </TableCell>
                <TableCell>
                  {veri?.success && enYakinIkamet && enYakinIkamet.bitisTarihi
                    ? format(new Date(enYakinIkamet.bitisTarihi), "dd MM yyyy")
                    : "Veri Yok"}
                </TableCell>
                <TableCell>{veri?.success ? gerekce : "Veri Yok"}</TableCell>{" "}
                {/* Yeni sütun */}
              </TableRow>
            );
          })}
        </TableBody>
      </Table>
    </div>
  );
};

export default Home;
